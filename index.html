<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í¬ë¦°ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .room-card { transition: 0.3s; min-height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .room-status-box { font-weight: bold; padding: 5px 10px; border-radius: 5px; margin-top: 5px; width: 100%; text-align: center; font-size: 0.9rem;}
        
        /* ìƒíƒœë³„ ìƒ‰ìƒ */
        .bg-available { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; } /* ì´ˆë¡ */
        .bg-occupied { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; } /* ë¹¨ê°• */
        .bg-closed { background-color: #e9ecef; color: #6c757d; border: 1px solid #dee2e6; } /* íšŒìƒ‰ (ìš´ì˜ì‹œê°„ ì•„ë‹˜) */

        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); z-index: 9999; display: none;
            justify-content: center; align-items: center;
        }
    </style>
</head>
<body class="bg-light">

<div id="loading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<div class="container py-4">
    <h2 class="mb-4 text-center fw-bold">â›³ ìŠ¤í¬ë¦°ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œ</h2>

    <h5 class="mb-3">ğŸ”´ í˜„ì¬ ë£¸ ì‚¬ìš© í˜„í™©</h5>
    <div class="row g-2 mb-4" id="roomStatusContainer">
        </div>

    <div class="d-flex justify-content-center gap-3 mb-4">
        <button class="btn btn-primary btn-lg" onclick="openNewReservation()">+ ìƒˆ ì˜ˆì•½í•˜ê¸°</button>
        <button class="btn btn-outline-secondary btn-lg" onclick="openCancelModifyModal()">ì˜ˆì•½ ì·¨ì†Œ / ë³€ê²½</button>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white fw-bold">ğŸ“… ì£¼ê°„ ì˜ˆì•½ í˜„í™©í‘œ</div> <div class="card-body">
            <ul class="nav nav-tabs mb-3" id="timetableTabs"></ul>
            <div class="table-responsive">
                <table class="table table-bordered text-center table-sm" style="font-size: 0.9rem;">
                    <thead class="table-light">
                        <tr>
                            <th>ì‹œê°„</th>
                            <th>Room 1</th><th>Room 2</th><th>Room 3</th><th>Room 4</th><th>Room 5</th>
                        </tr>
                    </thead>
                    <tbody id="timetableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="reservationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="resModalTitle">ì˜ˆì•½í•˜ê¸°</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="bookingForm">
                    <div class="mb-3">
                        <label class="form-label">ë‚ ì§œ ì„ íƒ</label>
                        <select class="form-select" id="inputDate" required onchange="updateTimeOptions()">
                            <option value="">-ì„ íƒí•´ì£¼ì„¸ìš”-</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ë£¸ ì„ íƒ</label>
                        <select class="form-select" id="inputRoom" required>
                            <option value="">-ì„ íƒí•´ì£¼ì„¸ìš”-</option>
                            <option value="Room 1">Room 1 (ì¼ë°˜)</option>
                            <option value="Room 2">Room 2 (ì¼ë°˜)</option>
                            <option value="Room 3">Room 3 (GDR+, ìŠ¤ìœ™ë¶„ì„)</option>
                            <option value="Room 4">Room 4 (ì–‘ì†ì¡ì´)</option>
                            <option value="Room 5">Room 5 (ê°œì¸í›ˆë ¨)</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label">ì¸ì›ìˆ˜</label>
                            <select class="form-select" id="inputPax" required onchange="handlePaxChange()">
                                <option value="">-ì„ íƒ-</option>
                                <option value="1">1ëª… (ìµœëŒ€ 1ì‹œê°„)</option>
                                <option value="2">2ëª… (ìµœëŒ€ 2ì‹œê°„)</option>
                                <option value="3+">3ëª… ì´ìƒ (ìµœëŒ€ 3ì‹œê°„)</option>
                            </select>
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label">ì´ìš© ì‹œê°„</label>
                            <select class="form-select" id="inputDuration" required onchange="updateTimeOptions()">
                                <option value="">-ì„ íƒ-</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì‹œì‘ ì‹œê°„</label>
                        <select class="form-select" id="inputStartTime" required>
                            <option value="">-ì„ íƒí•´ì£¼ì„¸ìš”-</option>
                        </select>
                        <small class="text-muted" id="timeHelpText"></small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì°¸ê°€ì ëª…ë‹¨</label>
                        <div id="nameListContainer"></div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="btnAddName" style="display:none;" onclick="addNameField()">+ ì¸ì› ì¶”ê°€</button>
                    </div>

                    <div class="alert alert-warning py-2" style="font-size: 0.85rem;">
                        â€» ì˜ˆì•½ ì·¨ì†Œ/ë³€ê²½ ì‹œ í•„ìš”í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”.
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <input type="password" class="form-control" id="inputPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" maxlength="4">
                        </div>
                        <div class="col-6 mb-3">
                            <input type="password" class="form-control" id="inputPwConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" maxlength="4">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" onclick="submitReservation()">ì˜ˆì•½ í™•ì •</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="manageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ì˜ˆì•½ ì·¨ì†Œ / ë³€ê²½</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted small">ë³€ê²½í•˜ë ¤ë©´ [ë³€ê²½] ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ì¡´ ì˜ˆì•½ì„ ì‚­ì œ í›„ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>
                <div class="list-group" id="manageList">
                    </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ==========================================
    // âš ï¸ [ì¤‘ìš”] ë°°í¬ëœ GAS URLì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”
    // ==========================================
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzrUbeaeASiOMDaJsCLSEq7Az2ZNUQS_ZjSaMwUjiv-fdZbiMFK9fuH8Uub5ipYEg5i/exec"; 
    
    let allReservations = [];
    let currentTabDate = new Date();

    document.addEventListener('DOMContentLoaded', () => {
        initDateDropdown(); 
        initTimetableTabs(); 
        fetchReservations(); 
    });

    // 1. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function fetchReservations() {
        showLoading(true);
        fetch(GAS_URL)
            .then(res => res.json())
            .then(json => {
                if(json.status === 'success') {
                    allReservations = json.data;
                    renderRoomStatus();
                    renderTimetable(currentTabDate);
                }
            })
            .catch(err => console.error(err))
            .finally(() => showLoading(false));
    }

    // 2. ì´ˆê¸° ì„¸íŒ…
    function initDateDropdown() {
        const select = document.getElementById('inputDate');
        select.innerHTML = '<option value="">-ì„ íƒí•´ì£¼ì„¸ìš”-</option>';
        const today = new Date();
        
        for(let i=0; i<7; i++) {
            const d = new Date(today);
            d.setDate(today.getDate() + i);
            const val = d.toISOString().split('T')[0];
            const txt = `${d.getMonth()+1}ì›” ${d.getDate()}ì¼ (${getDayName(d.getDay())})`;
            select.innerHTML += `<option value="${val}">${txt}</option>`;
        }
    }

    // 3. ì¸ì›ìˆ˜ ë³€ê²½ ì‹œ ë¡œì§
    function handlePaxChange() {
        const paxVal = document.getElementById('inputPax').value;
        const durationSelect = document.getElementById('inputDuration');
        const nameContainer = document.getElementById('nameListContainer');
        const btnAdd = document.getElementById('btnAddName');
        
        durationSelect.innerHTML = '<option value="">-ì„ íƒ-</option>';
        if(!paxVal) {
            nameContainer.innerHTML = '';
            btnAdd.style.display = 'none';
            return;
        }

        let maxTime = 1;
        let initialNameCount = 1;
        
        if (paxVal === '2') {
            maxTime = 2;
            initialNameCount = 2;
            btnAdd.style.display = 'none';
        } else if (paxVal === '3+') {
            maxTime = 3;
            initialNameCount = 3;
            btnAdd.style.display = 'inline-block'; 
        } else { 
            btnAdd.style.display = 'none';
        }

        for(let i=1; i<=maxTime; i++) {
            durationSelect.innerHTML += `<option value="${i}">${i}ì‹œê°„</option>`;
        }

        nameContainer.innerHTML = '';
        for(let i=0; i<initialNameCount; i++) {
            addNameField(false); 
        }
        
        updateTimeOptions(); 
    }

    function addNameField(showDeleteBtn = true) {
        const container = document.getElementById('nameListContainer');
        const div = document.createElement('div');
        div.className = 'input-group mb-2';
        
        let html = `<input type="text" class="form-control name-input" placeholder="ì´ë¦„" required>`;
        if(showDeleteBtn) {
            html += `<button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">ì‚­ì œ</button>`;
        }
        div.innerHTML = html;
        container.appendChild(div);
    }

    // 4. ì‹œì‘ ì‹œê°„ ì˜µì…˜ (ë¬¸êµ¬ ë³€ê²½ ë° ì‹œê°„ì œí•œ ì ìš©)
    function updateTimeOptions() {
        const dateVal = document.getElementById('inputDate').value;
        const durationVal = parseInt(document.getElementById('inputDuration').value);
        const timeSelect = document.getElementById('inputStartTime');
        const helpText = document.getElementById('timeHelpText');
        
        timeSelect.innerHTML = '<option value="">-ì„ íƒí•´ì£¼ì„¸ìš”-</option>';
        helpText.innerText = '';

        if(!dateVal || !durationVal) return;

        const date = new Date(dateVal);
        const day = date.getDay();
        
        let openHour, closeHour;
        
        // ìš”ì¼ë³„ ìš´ì˜ì‹œê°„
        if (day === 4) { // ëª©
            openHour = 17; closeHour = 22;
        } else if (day === 5) { // ê¸ˆ
            openHour = 6; closeHour = 22;
        } else { // í† ~ìˆ˜
            openHour = 19; closeHour = 22;
        }

        // [ìˆ˜ì •] ì•ˆë‚´ ë¬¸êµ¬ í†µì¼
        helpText.innerText = "ìš´ì˜ ì¢…ë£Œ ì‹œê°„: 22:00";

        const lastPossibleStart = closeHour - durationVal;

        for (let h = openHour; h <= lastPossibleStart; h++) {
            timeSelect.innerHTML += `<option value="${h}">${h}:00 (ì¢…ë£Œ ${h+durationVal}:00)</option>`;
        }
        
        if (lastPossibleStart < openHour) {
            timeSelect.innerHTML = '<option value="">ì´ìš© ê°€ëŠ¥í•œ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤</option>';
        }
    }

    // 5. ì˜ˆì•½ í™•ì •
    function submitReservation() {
        const date = document.getElementById('inputDate').value;
        const room = document.getElementById('inputRoom').value;
        const pax = document.getElementById('inputPax').value;
        const duration = document.getElementById('inputDuration').value;
        const startTime = document.getElementById('inputStartTime').value;
        const pw = document.getElementById('inputPw').value;
        const pwConfirm = document.getElementById('inputPwConfirm').value;

        const nameInputs = document.querySelectorAll('.name-input');
        let namesArr = [];
        nameInputs.forEach(input => { if(input.value.trim()) namesArr.push(input.value.trim()); });

        if(!date || !room || !pax || !duration || !startTime || !pw || !pwConfirm) {
            alert('ëª¨ë“  í•­ëª©ì„ ì„ íƒí•˜ê³  ì…ë ¥í•´ì£¼ì„¸ìš”.'); return;
        }
        if(namesArr.length === 0) {
            alert('ì°¸ê°€ì ì´ë¦„ì„ ìµœì†Œ 1ëª… ì…ë ¥í•´ì£¼ì„¸ìš”.'); return;
        }
        if(pw !== pwConfirm) {
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.'); return;
        }

        const payload = {
            action: 'book',
            date: date,
            room: room,
            pax: (pax === '3+') ? `${namesArr.length}ëª…` : `${pax}ëª…`,
            duration: duration,
            startTime: startTime,
            names: namesArr.join(', '),
            password: pw
        };

        if(!confirm(`ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në‚ ì§œ: ${date}\nì‹œê°„: ${startTime}ì‹œ (${duration}ì‹œê°„)\në£¸: ${room}`)) return;

        processApi(payload, () => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('reservationModal'));
            modal.hide();
        });
    }

    // 6. ì·¨ì†Œ/ë³€ê²½ ë¡œì§
    function openCancelModifyModal() {
        const listDiv = document.getElementById('manageList');
        listDiv.innerHTML = '';
        
        const todayStr = new Date().toISOString().split('T')[0];
        const futureRes = allReservations.filter(r => r.Date >= todayStr);
        
        if(futureRes.length === 0) {
            listDiv.innerHTML = '<p class="text-center p-3">ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
            futureRes.sort((a,b) => (a.Date + a.StartTime).localeCompare(b.Date + b.StartTime));
            
            futureRes.forEach(res => {
                const item = document.createElement('div');
                item.className = 'list-group-item d-flex justify-content-between align-items-center';
                item.innerHTML = `
                    <div>
                        <span class="badge bg-primary me-2">${res.Date}</span>
                        <span class="fw-bold">${res.StartTime}ì‹œ (${res.Duration}ì‹œê°„)</span>
                        <span class="ms-2 text-muted">${res.Room}</span>
                        <div class="small text-muted">ì˜ˆì•½ì: ${res.Names}</div>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline-warning me-1" onclick="modifyReservation('${res.ID}')">ë³€ê²½</button>
                        <button class="btn btn-sm btn-outline-danger" onclick="cancelReservation('${res.ID}')">ì·¨ì†Œ</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }
        
        new bootstrap.Modal(document.getElementById('manageModal')).show();
    }

    function cancelReservation(id) {
        const pw = prompt("ì˜ˆì•½ ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if(!pw) return;

        const payload = { action: 'cancel', id: id, password: pw };
        processApi(payload, () => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('manageModal'));
            modal.hide();
        });
    }

    function modifyReservation(id) {
        const targetRes = allReservations.find(r => String(r.ID) === String(id));
        if(!targetRes) return;

        const pw = prompt("ë³€ê²½(ê¸°ì¡´ ì˜ˆì•½ ì‚­ì œ)ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if(!pw) return;

        showLoading(true);
        fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'cancel', id: id, password: pw })
        })
        .then(res => res.json())
        .then(json => {
            showLoading(false);
            if(json.status === 'success') {
                bootstrap.Modal.getInstance(document.getElementById('manageModal')).hide();
                setTimeout(() => {
                    openNewReservation(); 
                    document.getElementById('inputDate').value = targetRes.Date;
                    document.getElementById('inputRoom').value = targetRes.Room;
                    updateTimeOptions(); 
                    alert('ê¸°ì¡´ ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥ í›„ ë‹¤ì‹œ ì˜ˆì•½í•´ì£¼ì„¸ìš”.');
                }, 500);
            } else {
                alert(json.message);
            }
        });
    }

    function processApi(payload, onSuccess) {
        showLoading(true);
        fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(json => {
            if(json.status === 'success') {
                alert(json.message);
                fetchReservations();
                if(onSuccess) onSuccess();
            } else {
                alert('ì‹¤íŒ¨: ' + json.message);
            }
        })
        .catch(err => {
            console.error(err);
            alert('ì˜¤ë¥˜ ë°œìƒ');
        })
        .finally(() => showLoading(false));
    }

    function openNewReservation() {
        document.getElementById('bookingForm').reset();
        document.getElementById('nameListContainer').innerHTML = '';
        document.getElementById('btnAddName').style.display = 'none';
        document.getElementById('inputDuration').innerHTML = '<option value="">-ì„ íƒ-</option>';
        document.getElementById('inputStartTime').innerHTML = '<option value="">-ì„ íƒí•´ì£¼ì„¸ìš”-</option>';
        new bootstrap.Modal(document.getElementById('reservationModal')).show();
    }

    // [ìˆ˜ì •ë¨] ì‹¤ì‹œê°„ í˜„í™© ë Œë”ë§ (ìš´ì˜ì‹œê°„ ì²´í¬ ë¡œì§ ì¶”ê°€)
    function renderRoomStatus() {
        const container = document.getElementById('roomStatusContainer');
        container.innerHTML = '';
        const rooms = [
            { id: 'Room 1', desc: 'ì¼ë°˜' },
            { id: 'Room 2', desc: 'ì¼ë°˜' },
            { id: 'Room 3', desc: 'GDR+' },
            { id: 'Room 4', desc: 'ì–‘ì†' },
            { id: 'Room 5', desc: 'ê°œì¸' }
        ];

        const now = new Date();
        const todayStr = now.toISOString().split('T')[0];
        const currentHour = now.getHours();
        const day = now.getDay(); // 0(ì¼)~6(í† )

        // 1. ì˜¤ëŠ˜ ìš´ì˜ì‹œê°„ í™•ì¸
        let openHour, closeHour;
        if (day === 4) { // ëª©
            openHour = 17; closeHour = 22;
        } else if (day === 5) { // ê¸ˆ
            openHour = 6; closeHour = 22;
        } else { // í† ~ìˆ˜
            openHour = 19; closeHour = 22;
        }

        // 2. í˜„ì¬ ì‹œê°„ì´ ìš´ì˜ì‹œê°„ì¸ì§€ ì²´í¬
        const isClosed = (currentHour < openHour || currentHour >= closeHour);

        rooms.forEach(room => {
            let statusClass, statusText;

            if (isClosed) {
                // ìš´ì˜ì‹œê°„ ì•„ë‹˜ (íšŒìƒ‰)
                statusClass = 'bg-closed';
                statusText = 'ì´ìš© ë¶ˆê°€ (ìš´ì˜ì‹œê°„ ì•„ë‹˜)';
            } else {
                // ìš´ì˜ì‹œê°„ ì¤‘ -> ì˜ˆì•½ í™•ì¸ (ì´ˆë¡/ë¹¨ê°•)
                const activeRes = allReservations.find(res => {
                    const start = parseInt(res.StartTime);
                    const end = start + parseInt(res.Duration);
                    return res.Date === todayStr && res.Room === room.id && currentHour >= start && currentHour < end;
                });

                if (activeRes) {
                    statusClass = 'bg-occupied';
                    statusText = `ì‚¬ìš© ì¤‘ (${activeRes.Names})`;
                } else {
                    statusClass = 'bg-available';
                    statusText = 'ì‚¬ìš© ê°€ëŠ¥';
                }
            }

            const col = document.createElement('div');
            col.className = 'col-6 col-md-2dot4'; 
            col.style.width = '20%'; 
            if(window.innerWidth < 768) col.style.width = '50%';

            col.innerHTML = `
                <div class="card room-card shadow-sm border-0">
                    <div class="fw-bold">${room.id}</div>
                    <small class="text-muted">${room.desc}</small>
                    <div class="room-status-box ${statusClass}">
                        ${statusText}
                    </div>
                </div>
            `;
            container.appendChild(col);
        });
    }

    function initTimetableTabs() {
        const ul = document.getElementById('timetableTabs');
        ul.innerHTML = '';
        const today = new Date();
        for(let i=0; i<7; i++) {
            const d = new Date(today);
            d.setDate(today.getDate() + i);
            const dateStr = d.toISOString().split('T')[0];
            ul.innerHTML += `<li class="nav-item"><a class="nav-link ${i===0?'active':''}" href="#" onclick="switchTab('${dateStr}', this); return false;">${d.getMonth()+1}/${d.getDate()}</a></li>`;
        }
    }

    function switchTab(dateStr, el) {
        document.querySelectorAll('#timetableTabs .nav-link').forEach(a => a.classList.remove('active'));
        el.classList.add('active');
        currentTabDate = new Date(dateStr);
        renderTimetable(currentTabDate);
    }
    
    function renderTimetable(targetDateObj) {
        const tbody = document.getElementById('timetableBody');
        tbody.innerHTML = '';
        const targetDateStr = targetDateObj.toISOString().split('T')[0];
        const day = targetDateObj.getDay();
        
        let start, end;
        if ([6, 0, 1, 2, 3].includes(day)) { start = 19; end = 22; }
        else if (day === 4) { start = 17; end = 22; }
        else { start = 6; end = 22; }

        for (let h = start; h < end; h++) {
            let rowHtml = `<tr><td class="align-middle">${h}:00</td>`;
            for (let r = 1; r <= 5; r++) {
                const roomName = `Room ${r}`;
                const booking = allReservations.find(res => {
                    const rStart = parseInt(res.StartTime);
                    const rDuration = parseInt(res.Duration);
                    return res.Date === targetDateStr && res.Room === roomName && h >= rStart && h < (rStart + rDuration);
                });

                if (booking) {
                    rowHtml += `<td class="bg-occupied align-middle"><div class="fw-bold small">${booking.Names}</div></td>`;
                } else {
                    rowHtml += `<td></td>`;
                }
            }
            rowHtml += `</tr>`;
            tbody.innerHTML += rowHtml;
        }
    }

    function showLoading(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }
    function getDayName(d) { return ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d]; }

</script>
</body>
</html>
